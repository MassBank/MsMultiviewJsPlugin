"use strict";!function(a,b,c,d){var e={util:{getGUID:function(){var a=function(){return Math.floor(65536*Math.random()).toString(16)};return"GUID-"+a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},addCss:function(b){b=JSON.stringify(b).replace(/"/g,"").replace(/,/g,";"),a("<style>").prop("type","text/css").html(b).appendTo("head")}},plugin:{validate:function(a){return 0==a.length?void console.log("[ERROR] no arguments"):e.storage.isBrowserSupport()?(console.log("[SUCCESS] successfully validated."),!0):void console.log("[ERROR] no localStorage support")},getParams:function(b){function e(b){a.fn.msmultiview.defaults.highcharts.yAxis.title.text=b.chart.yAxis.title.text,a.fn.msmultiview.defaults.highcharts.series[0].name=b.chart.xAxis.title.text,a.fn.msmultiview.defaults.highcharts.series[0].custom.maxmzmarker=b.chart.maxmzmarker,a.fn.msmultiview.defaults.highcharts.series[0].custom.intensitythreshold=b.chart.intensitythreshold}var c={urls:[],opts:null},d=a.fn.msmultiview.defaults.param;return e(d),c.opts=a.extend(!0,{},a.fn.msmultiview.defaults,{}),a.each(b,function(b,f){a.isPlainObject(f)&&(b>0?(d=a.extend(!0,{},a.fn.msmultiview.defaults.param,f.param),e(d),c.opts=a.extend(!0,{},a.fn.msmultiview.defaults,f)):console.log("Invalid argument in initial position."))}),a.each(b,function(b,d){if(!a.isPlainObject(d)){var e=a.isArray(d)?d:a.makeArray(d);a.each(e,function(a,b){0===b.indexOf("http://")||0===b.indexOf("https://")?c.urls.push(b):c.urls.push(c.opts.param.apiUrlPrefix+b)})}}),c},init:function(b,c){var d={success:[],failure:[]},g=f.event,h=[];f.param.chart.options=c.opts,b.html("<div class='loader-container'><div class='text'>Loading...</div><div class='loader'></div></div>");var i=[];i.push(".loader-container { text-align: center; }"),i.push(".loader-container .text { color: #f3f3f3; font-size: 2rem; }"),i.push(".loader-container .loader { margin: 2% auto; border: .2rem solid #f3f3f3; width: 60px; height: 60px; -webkit-animation: spin 2s linear infinite; animation: spin 2s linear infinite; }"),i.push("@-webkit-keyframes spin { 0% { -webkit-transform: rotate(0deg); } 100% { -webkit-transform: rotate(360deg); } }"),i.push("@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }"),e.util.addCss(i.join("")),a.each(c.urls,function(b,c){h.push(a.ajax({type:"GET",url:c,async:!1,dataType:"jsonp",crossDomain:!0,success:function(a,e,f){var h=g.chart.load.success(a,e,f);h&&h.length>0?(h[0].url=c,h[0].index=b,d.success.push(h[0])):d.failure.push(c)}}))}),a.when.apply(null,h).done(function(){d.success.sort(function(a,b){return parseInt(a.index)-parseInt(b.index)}),e.plugin.render(b,d,f.param.chart.options)})},render:function(a,b,c){a.empty();var d=e.plugin.getKey(a);e.storage.merge(d,b.success),c.windowsmanager.enabled&&e.windowsmanager.init(a,b.failure),e.highcharts.render(a,c.highcharts),e.popup.init(),c.chartszoomer.enabled&&e.chartszoomer.render(a)},code:function(){e.popup.show();var c=e.popup.getWrapper();c.empty().show();var d=[],f=[];d.push("<p>The MultiView sample plugin</p>"),b.location.origin.indexOf("https://massbank.nig.ac.jp")!=-1?(d.push("<p>Updated URL:</p>"),d.push("<code>"),a(".current-window ul li").each(function(){f.push(a(this).attr("data-id"))}),d.push(b.location.href.replace(/(my_ids=)[^\&]+/,"$1"+f.join(","))),d.push("</code>"),d.push("<p>JavaScript code:</p>"),d.push("<code>"),d.push("&lt;script type='text/javascript'&gt;<br/>"),d.push("mv.event.chart.load.success = function( response, status, xhr ) {<br/>"),d.push("&emsp;&emsp;// TODO: data convertion code here.<br/>"),d.push("}"),d.push("<br/>&lt;/script&gt;"),d.push("</code>")):(d.push("<p>HTML code:</p>"),d.push("<code>"),d.push("&lt;div id='ms-multiview'&gt;&lt;/div&gt;"),d.push("</code>"),d.push("<p>JavaScript code:</p>"),d.push("<code>"),d.push("&lt;script type='text/javascript'&gt;<br/><br/>"),d.push("mv.event.chart.load.success = function( response, status, xhr ) {<br/>"),d.push("&emsp;&emsp;// TODO: data convertion code here.<br/>"),d.push("}<br/><br/>"),d.push("$( window ).load( function () {<br/>"),a(".current-window ul li").each(function(){f.push("'"+a(this).attr("data-url")+"'")}),d.push("&emsp;&emsp;$( '#ms-multiview' ).multiview( "+f.join(", ")+" );"),d.push("<br/>});"),d.push("<br/><br/>&lt;/script&gt;"),d.push("</code>")),c.html(d.join(""))},getKey:function(a){return b.name.match(/^GUID-/)||(b.name=e.util.getGUID()),a.attr("data-plugin-key")&&0!==a.attr("data-plugin-key").length||a.attr("data-plugin-key",b.name),a.attr("data-plugin-key")},getRoot:function(b){return a(".ms-multiview[data-plugin-key='"+b+"']")}},popup:{init:function(){e.popup.html(),e.popup.style()},show:function(){var c=a("#mv-popup-container");a("#mv-popup-container .wrapper").html(e.popup.param.text.loading),a("#mb-overlay-shade").fadeTo(300,.6,function(){var d={oLayWidth:c.width(),scrTop:a(b).scrollTop(),viewPortWidth:a(b).width()},e=(d.viewPortWidth-d.oLayWidth)/2;c.css({display:"block",opacity:0,top:"-=300",left:e+"px"}).animate({top:d.scrTop+40,opacity:1},600)})},html:function(){if(0==a("#mv-popup-container").length){var b=[];b.push("<div id='mv-popup-container' class='overlay'>"),b.push("<div class='toolbar'>"),b.push("<a class='close btn' href='#'>close</a>"),b.push("</div>"),b.push("<div class='wrapper'>"+e.popup.param.text.loading+"</div>"),b.push("</div>"),a("body").prepend(b.join(""))}0==a("#mb-overlay-shade").length&&a("body").prepend("<div id='mb-overlay-shade'></div>"),a("#mb-overlay-shade, .overlay a").click(function(b){e.popup.event.close(),"#"==a(this).attr("href")&&b.preventDefault()})},style:function(){var a=[];a.push("#mb-overlay-shade { display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: 9999; background-color: #000; }"),a.push(".overlay { display: none; position: absolute; top: -1000px; left: 0; width: 670px; min-height: 200px; z-index: 10000; background-color: #FFF; border: 5px solid #CFCFCF; }"),a.push(".ie7 .overlay { height: 200px; }"),a.push(".overlay .wrapper { padding: 15px 30px 30px; font-size: 3rem; color: #828282; }"),a.push(".overlay .wrapper code { font-size: .875rem; color: #ccc; background: #1d1f21; display: block; padding: 15px; border-radius: 4px; line-height: 1.5; overflow: auto; }"),a.push(".overlay .wrapper p { font-size: 1.25rem; margin: 0.5rem; }"),a.push(".overlay .toolbar { padding: 8px; line-height: 1; text-align: right; overflow: hidden; }"),e.util.addCss(a.join(""))},getWrapper:function(){return a("#mv-popup-container .wrapper")},event:{close:function(){a(".overlay").animate({top:"-=300",opacity:0},400,function(){a("#mb-overlay-shade").fadeOut(300),a(this).css("display","none"),a(this).find(".wrapper").html("Loading...")})}},param:{text:{loading:"Loading..."}}},storage:{isBrowserSupport:function(){return"undefined"!=typeof Storage},isContains:function(a,b){if(b.length>0)for(var c=0;c<b.length;c++)if(b[c].id==a.id)return!0;return!1},get:function(a){try{return JSON.parse(localStorage.getItem(a))}catch(a){}},getAll:function(){for(var a=[],b=0;b<localStorage.length;b++){var c=localStorage.key(b);c.match(/^GUID-/)&&a.push({key:c,value:JSON.parse(localStorage[c])})}return a},getInfoById:function(b,c){var f,d=e.storage.get(b);return a(d).each(function(a,b){if(b.id==c)return void(f=b)}),f},set:function(a,b){try{return localStorage.setItem(a,JSON.stringify(b)),!0}catch(a){}return!1},merge:function(b,c){var d=this.get(b);d||(d=[]);var f=[];a.isArray(c)?f=c:f.push(c),a.each(f,function(a,b){e.storage.isContains(b,d)||d.push(b)}),this.set(b,d)},reset:function(a,b){e.storage.remove(a),e.storage.merge(a,b)},remove:function(a){localStorage.removeItem(a)},clearWindowData:function(a){for(var b=0;b<localStorage.length;b++){var c=localStorage.key(b);c.match(/^GUID-/)&&c.startsWith(a)&&localStorage.removeItem(c)}}},windowsmanager:{init:function(a,b){var c=e.plugin.getKey(a);e.windowsmanager.style();var d=e.windowsmanager.html.container(a);e.windowsmanager.html.init(d),e.windowsmanager.event.init(d,c),e.windowsmanager.render(a,b)},render:function(a,b){var c=e.plugin.getKey(a),d=e.windowsmanager.html.container(a);e.windowsmanager.html.error(d,b),e.windowsmanager.html.windows(d,c),e.windowsmanager.event.render(d),e.windowsmanager.event.toggleEquivalents()},html:{container:function(b){var c=b.find(".mv-windows-manager:first");return 0==c.length&&(c=a("<div class='mv-windows-manager frame'></div>"),c.appendTo(b)),c},init:function(a){a.empty();var b=[];b.push("<div class='accordion active'>Multiview Windows Manager</div>"),b.push("<div class='panel show'></div>"),a.append(b.join(""));var c=a.find(".panel:first"),d=[];d.push("<div class='btn-container'>"),d.push("<div style='float: left;'>This is a massbank Volatile:MultiView windows managing area.</div>"),d.push("<div style='float: right;'>"),d.push("<button class='btn-apply btn'>apply changes</button>"),d.push("<button class='btn-code btn' style='margin-left: 5px;'>code</button>"),d.push("</div>"),d.push("<br clear='all'/>"),d.push("</div>"),c.append(d.join(""));var e=[];e.push("<div class='hdr-container'>"),e.push("<div class='currentwin-hdr-container'>Current Window</div>"),e.push("<div class='otherwins-hdr-container'>Other Windows/Tabs</div>"),e.push("</div>"),c.append(e.join(""));var f=[];f.push("<div class='windows-container'>"),f.push("<div class='left-windows-container'></div>"),f.push("<div class='right-windows-container'></div>"),f.push("</div>"),c.append(f.join(""))},error:function(b,c){if(c&&c.length>0){var d=b.find(".panel:first"),e=[];e.push("<div class='error-container'>"),a.each(c,function(a,b){e.push("<div class='error'>"),e.push("<span class='btn-close' onclick=\"this.parentElement.style.display='none';\">&times;</span>"),e.push("[ERROR URL] "+b),e.push("</div>")}),e.push("</div>"),d.append(e.join(""))}},windows:function(b,c){var d=e.storage.getAll();if(d.length>0){var f=b.find(".panel:first"),g=f.find(".right-windows-container:first"),h=f.find(".left-windows-container:first");g.empty(),h.empty(),a.each(d,function(b,d){var e=d.key,f=d.value,i=c==d.key,j=[],k=i?"current-window":"other-window";j.push("<div alt='"+e+"' class='"+k+" win-info-container'>"),j.push("<div class='container-header'></div>"),j.push("<div class='container-body'>"),j.push("<ul>"),a.each(f,function(a,b){var c=b.index,d=b.id,f=b.url,g=b.title;d&&(j.push("<li data-index='"+c+"' data-id='"+d+"' data-url='"+f+"' data-plugin-key='"+e+"'>"),j.push("<span class='massbank-title truncate tooltip' title='"+g+"'>"+g+"</span>"),j.push("<span class='nav-action remove' title='remove'></span>"),j.push("<span class='nav-action chart' title='show chart'></span>"),j.push("<span class='nav-action copy' title='add'></span>"),j.push("<span style='clear:both;'></span>"),j.push("</li>"))}),j.push("</ul>"),j.push("</div>"),j.push("</div>"),i?h.append(j.join("")):g.append(j.join(""))})}}},event:{init:function(b,c){a(b).find(".accordion").click(function(){a(this).toggleClass("active"),a(this).next().toggleClass("show")}),a(b.find(".current-window ul")).sortable(),b.find(".btn-apply:first").click(function(a){if(0==e.highcharts.param.chart.remain_count){var b=e.plugin.getRoot(c);e.windowsmanager.event.update(c),e.highcharts.render(b,f.param.chart.options)}else console.log("[PENDING] waiting...")}),b.find(".btn-code:first").click(function(a){e.plugin.code()})},render:function(b){a(b.find(".current-window ul")).sortable(),b.find(".remove").click(function(){var b=a(this),c=b.closest("li"),d=c.attr("data-id");c.remove(),e.windowsmanager.event.toggleEquivalents(d)}),b.find(".copy").click(function(){var c=a(this).closest("li"),d=c.attr("data-id");b.find(".current-window ul").append(c.clone(!0)),e.windowsmanager.event.toggleEquivalents(d)}),b.find(".chart").click(function(){var b=a(this).closest("li"),c=b.attr("data-plugin-key"),d=b.attr("data-id");e.highcharts.image.render(c,d,f.param.chart.options)})},update:function(b){var c=e.plugin.getRoot(b),d=[],f=c.find(".win-info-container.current-window ul li");f.length>0?(d=a.map(f,function(b){return e.storage.getInfoById(a(b).attr("data-plugin-key"),a(b).attr("data-id"))}),e.storage.reset(b,d),e.windowsmanager.render(c)):console.log("No MassBank Id")},toggleEquivalents:function(b){b?a(".win-info-container.other-window li[data-id='"+b+"']").toggleClass("equalid"):(a(".win-info-container.other-window li").removeClass("equalid"),a(".win-info-container.current-window li").each(function(){a(".win-info-container.other-window li[data-id='"+a(this).attr("data-id")+"']").addClass("equalid")}))}},style:function(){var a=[];a.push(".ms-multiview .frame { border: .1rem solid #eee; padding: .1rem; margin-bottom: .2rem; overflow: hidden; }"),a.push(".mv-windows-manager { font-family: 'Segoe UI', 'Open Sans', sans-serif, serif; font-size: 0.875rem; line-height: 1.1; font-weight: 400; }"),a.push(".mv-windows-manager .accordion { background-color: #eee; color: #444; cursor: pointer; padding: .626rem; text-align: left; border: none; outline: none; transition: 0.4s; font-size: 1.2rem; }"),a.push(".mv-windows-manager .accordion:after { content: '+'; font-size: 1rem; color: #777; float: right; margin-left: 5px; }"),a.push(".mv-windows-manager .accordion.active, .mv-windows-manager .accordion:hover { background-color: #ddd; }"),a.push(".mv-windows-manager .accordion.active:after { content: '-'; }"),a.push(".mv-windows-manager .panel { padding: 0 10px; background-color: white; display: none; }"),a.push(".mv-windows-manager .panel.show { display: block !important; }"),a.push(".mv-windows-manager .error-container { /*color: #cc0000; border-color: #fac5c5; background-color: #fae3e3; font-size: 0.9em; margin: 1em 0; padding: 0.5em; word-wrap: break-word;*/ } "),a.push(".mv-windows-manager .error { padding: 10px; background-color: #f44336; color: white; margin: 5px 0; word-wrap: break-word; font-size: 0.925rem; }"),a.push(".mv-windows-manager .btn-close { margin-left: 5px; color: white; font-weight: bold; float: right; cursor: pointer; transition: 0.3s; }"),a.push(".mv-windows-manager .btn-close:hover { color: black; }"),a.push(".mv-windows-manager .windows-container { white-space: nowrap; padding-left: 250px; border: 1px solid #eee; position: relative; margin: 10px 0; height: 165px; }"),a.push(".mv-windows-manager .windows-container:after, .mv-windows-manager .hdr-container .otherwins-hdr-container:after { content: ''; visibility: hidden; display: block; height: 0; clear: both; }"),a.push(".mv-windows-manager .btn-container { margin-top: 10px; }"),a.push(".mv-windows-manager .hdr-container .currentwin-hdr-container { float: left; width: 250px; font-size: 1.25rem; padding-left: 5px; }"),a.push(".mv-windows-manager .hdr-container .otherwins-hdr-container { font-size: 1.25rem; }"),a.push(".mv-windows-manager .windows-container .right-windows-container { overflow-x: auto; overflow-y: hidden; height: 100%; }"),a.push(".mv-windows-manager .windows-container .win-info-container { display: inline-block; height: 100%; }"),a.push(".mv-windows-manager .windows-container .win-info-container.current-window .container-body { background: #eff; border-right: 1px solid #eee; }"),a.push(".mv-windows-manager .windows-container .win-info-container.other-window .container-body { border-right: 1px dashed #eee; }"),a.push(".mv-windows-manager .windows-container .win-info-container .container-body { overflow-y: auto; overflow-x: hidden; height: 100%; width: 250px; }"),a.push(".mv-windows-manager .windows-container .win-info-container.current-window { position: absolute; left: 0; height: 100%; }"),a.push(".mv-windows-manager .windows-container .win-info-container ul { list-style: none; list-style-type: none; margin: 0; padding: 5px 0 0 0; }"),a.push(".mv-windows-manager .windows-container .win-info-container ul li { border: 1px solid #eee; margin: 0 5px 5px 5px; padding: 5px; width: 215px; background: #FFF; }"),a.push(".mv-windows-manager .windows-container .win-info-container.current-window ul li { cursor: pointer; }"),a.push(".mv-windows-manager .windows-container .win-info-container li.equalid { background-color: #eaeaea; cursor: default; color: #bebebe; border-color: transparent; }"),a.push(".mv-windows-manager .windows-container .win-info-container li.equalid .nav-action { display: none; }"),a.push(".mv-windows-manager .windows-container .win-info-container .nav-action { display: inline-block; font-size: .825rem; cursor: pointer; margin-left: 2px; padding: 2px 5px; border: 1px solid #DDD; border-radius: 2px; }"),a.push(".mv-windows-manager .windows-container .win-info-container .nav-action:hover { background: #eee; }"),a.push(".mv-windows-manager .windows-container .win-info-container.current-window .nav-action.copy { display: none; }"),a.push(".mv-windows-manager .windows-container .win-info-container.other-window .nav-action.remove { display: none; }"),a.push(".mv-windows-manager .windows-container .win-info-container .nav-action.copy:before { content: '+'; }"),a.push(".mv-windows-manager .windows-container .win-info-container .nav-action.chart:before { content: 'chart'; }"),a.push(".mv-windows-manager .windows-container .win-info-container .nav-action.remove:before { content: 'x'; }"),a.push(".mv-windows-manager .truncate { width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: inline-block; }"),a.push(".mv-windows-manager .btn { background: #00af89; color: #fff; border: 1px solid #00af89; border-radius: 2px; text-shadow: 0 1px rgba(0,0,0,0.1); box-sizing: border-box; margin: 0; padding: .5em 1em; vertical-align: middle; font-weight: bold; cursor: pointer; }"),a.push(".mv-windows-manager .btn:HOVER { background-color: #008c6d; }"),e.util.addCss(a.join(""))}},chartszoomer:{render:function(b){var c=b.find(".mv-zoomer-container:first");0==c.length&&(c=a("<div class='mv-zoomer-container'></div>"),c.appendTo(b)),c.empty(),e.chartszoomer.style(),e.chartszoomer.html(c),e.chartszoomer.event.init(c)},html:function(a){var b=[];b.push("<div class='btn-zoom-in btn' title='zoom in'>+</div>"),b.push("<div class='btn-zoom-out btn' title='zoom out'>-</div>"),b.push("<div class='btn-zoom-default btn' title='zoom default'>1:1</div>"),a.append(b.join(""))},style:function(){var a=[];a.push(".mv-zoomer-container { opacity: .25; filter:alpha(opacity=25); position: fixed; top: 50%; left: 0; z-index: 1000; background: #EEE; border: 1px solid #CCC; padding: .25rem; }"),a.push(".mv-zoomer-container:hover { opacity: 1; filter:alpha(opacity=100); }"),a.push(".mv-zoomer-container .btn { background: #00af89; text-align: center; color: #fff; border: 1px solid #EEE; padding: .5em; vertical-align: middle; font-size: 1.5rem; font-weight: bold; cursor: pointer; margin: .2rem; }"),a.push(".mv-zoomer-container .btn:HOVER { background-color: #008c6d; }"),e.util.addCss(a.join(""))},event:{init:function(b){var c=e.chartszoomer.param.zoom;b.find(".btn-zoom-in").click(function(){c.current>0&&(c.current=c.current-1,a(".mv-chart-container").css("width",100/c.current+"%"),e.highcharts.event.resize())}),b.find(".btn-zoom-out").click(function(){c.current<=4&&(c.current=c.current+1,a(".mv-chart-container").css("width",100/c.current+"%"),e.highcharts.event.resize())}),b.find(".btn-zoom-default").click(function(){1!=c.current&&(c.current=1,a(".mv-chart-container").css("width",100/c.current+"%"),e.highcharts.event.resize())})}},param:{zoom:{min:1,max:5,current:1}}},highcharts:{render:function(b,c){var d=b.find(".mv-charts-container:first");0==d.length&&(d=a("<div class='mv-charts-container'></div>"),d.appendTo(b)),d.empty();var f=e.plugin.getKey(b);e.highcharts.style(),e.highcharts.html(d,f,c)},html:function(b,c,d){var f=e.storage.get(c);f.length>0&&a.each(f,function(c,f){a("<div class='mv-chart-container frame' alt='"+f.id+"'></div>").appendTo(b);var g=a.extend(!0,{},a.fn.msmultiview.defaults.highcharts,d);g.title.text=f.title,e.highcharts.event.load(f.id,g,f.series_data)})},style:function(){var a=[];a.push(".mv-charts-container { display: inline; }"),a.push(".mv-charts-container .mv-chart-container { display: inline-block; box-sizing: border-box; width: 100%; }"),a.push(".highcharts-container .highcharts-tooltip table { font-size: .925em; }"),a.push(".highcharts-container .highcharts-tooltip table td { white-space: nowrap; }"),a.push(".highcharts-container .highcharts-data-labels tspan[style^='font-style:'] { visibility: hidden; }"),a.push(".highcharts-container.show-all-labels .highcharts-data-labels tspan[style^='font-style:'] { visibility: visible; }"),a.push(".highcharts-container .highcharts-data-labels text:last-child * { fill: red; font-size: 11px; }"),e.util.addCss(a.join(""))},event:{load:function(b,c,d){a(".mv-chart-container[alt='"+b+"']:first").highcharts(c),e.highcharts.param.chart.remain_count++;var f=a(".mv-chart-container[alt='"+b+"']:first").highcharts();f.showLoading("loading..."),setTimeout(function(){f.series[0].setData(d),f.hideLoading(),e.highcharts.param.chart.remain_count--},250)},syncExtremes:function(a){var b=this.chart;"syncExtremes"!==a.trigger&&Highcharts.each(Highcharts.charts,function(c){c&&c!==b&&c.xAxis[0].setExtremes&&(c.xAxis[0].setExtremes(a.min,a.max,d,!1,{trigger:"syncExtremes"}),e.highcharts.event.renderLabel())});try{f.event.chart.afterSyncExtremes()}catch(a){}},renderLabel:function(){a('.highcharts-data-labels tspan[style^="font-style:"]').css("font-style","normal")},zoomOut:function(){Highcharts.each(Highcharts.charts,function(a){a&&a.zoomOut()});try{f.event.chart.afterZoomOut()}catch(a){}},doubleClick:function(){e.highcharts.clickDetected?(e.highcharts.event.zoomOut(),e.highcharts.clickDetected=!1):(e.highcharts.clickDetected=!0,setTimeout(function(){e.highcharts.clickDetected=!1},500))},resize:function(){var b=a(".mv-chart-container:first").width(),c=400,d=Highcharts.charts;a.each(d,function(a,d){d.setSize(b,c)})}},image:{render:function(b,c,d){e.popup.show();var f=e.storage.getInfoById(b,c),g=a.extend(!0,{},a.fn.msmultiview.defaults.highcharts,d);g.title.text=f.title,g.series[0].data=f.series_data,g.plotOptions.series.dataLabels={};var h=a.fn.msmultiview.defaults.highchartsImage.exportData;h.options=JSON.stringify(g);var i=e.popup.getWrapper();a.ajax({type:"post",url:a.fn.msmultiview.defaults.highchartsImage.exportUrl,data:h,success:function(b){i.empty().show(),a("<img>").attr("src",a.fn.msmultiview.defaults.highchartsImage.exportUrl+b).appendTo(i)}})}},param:{chart:{remain_count:0}}}},f={param:{chart:{}},event:{chart:{load:{success:function(b,c,d){if(!b.query.pages[-1]){var e=[];return a.each(b.query.pages,function(b,c){var f,d=[],g=c.title,h=c.title;a.each(c.revisions[0],function(b,c){for(var e=c.split("\n"),g=!1,h=0,i=e.length;h<i;h++){var j=e[h];if(j.indexOf("inchikey")>-1&&(f=/<img[^>]+src="(https:\/\/[^">]+)"/g.exec(j)[1]),g){j=a.trim(j);var k=j.split(" ");if(a.isNumeric(k[0])&&a.isNumeric(k[2])){var l=parseFloat(k[0]),m=parseFloat(k[2]);d.push([l,m])}}0==j.indexOf("PK$PEAK")&&(g=!0)}}),e.push({id:g,title:h,max_y:999,pubchem_url:f,series_data:d})}),e}}},afterLoad:function(a){console.log("afterLoad... "+Date()+" ["+a+"]")},afterSyncExtremes:function(){console.log("afterSyncExtremes...")},afterZoomOut:function(){console.log("afterZoomOut...")}}}};b.mv=b.msmultiview=f,a.fn.msmultiview=function(){if(e.plugin.validate(arguments)){var c=a(this),d=e.plugin.getParams(arguments);c.length>1&&(c=a(c[0]),console.log("[warning] There are selectors. multiview plugin initialize only for a one selector.")),c.removeClass("ms-multiview").addClass("ms-multiview"),e.plugin.init(c,d),a(b).unload(function(){e.storage.clearWindowData(b.name)}),a(b).resize(function(){setTimeout(e.highcharts.event.resize,100),console.log("window resize...")}),a(b).focus(function(){var a=e.plugin.getRoot(b.name);e.windowsmanager.render(a),console.log("window focus...")})}},a.fn.msmultiview.defaults={param:{chart:{yAxis:{title:{text:"rel-intensity"}},xAxis:{title:{text:"m/z"}},maxmzmarker:" ◀ ",intensitythreshold:800},apiUrlPrefix:"https://massbank.nig.ac.jp/mediawiki/api.php?format=json&action=query&prop=revisions&rvprop=content&rvparse=1&titles="},windowsmanager:{enabled:!0},chartszoomer:{enabled:!0},highcharts:{chart:{type:"column",height:400,spacingRight:20,zoomType:"x",resetZoomButton:{theme:{display:"none"}},events:{load:function(){try{e.highcharts.event.renderLabel(),f.event.chart.afterLoad(a(this.container).closest(".mv-chart-container").attr("alt"))}catch(a){}},click:function(){try{e.highcharts.event.doubleClick()}catch(a){}}}},credits:{enabled:!1},title:{text:""},rangeSelector:{selected:1},xAxis:{crosshair:!0,min:0,minRange:1,events:{setExtremes:e.highcharts.event.syncExtremes}},yAxis:{max:1250,min:0,minRange:1e3,title:{text:""}},tooltip:{useHTML:!0,formatter:function(){var a="<table><tr style='color:{0}'><td>{1}:</td><td><b>{2}</b></td></tr><tr><td>{3}:</td><td><b>{4}</b></td></tr></table>";return a.replace("{0}",this.series.color).replace("{1}",this.series.name).replace("{2}",this.x).replace("{3}",this.series.yAxis.axisTitle?this.series.yAxis.axisTitle.textStr:"Value").replace("{4}",this.y)}},plotOptions:{cursor:"pointer",allowPointSelect:!0,series:{dataLabels:{enabled:!0,useHTML:!0,rotation:-90,y:-25,style:{fontWeight:"normal",fontSize:"9px"},formatter:function(){var a=[],b=this.x==this.series.data[this.series.data.length-1].x;b&&a.push("<b>"+this.series.options.custom.maxmzmarker+"</b>");var c=Math.round(100*this.x)/100;return this.y>=this.series.options.custom.intensitythreshold?a.push("<span>"+c+"</span>"):a.push("<i>"+c+"</i>"),a.join("")}}}},series:[{name:"",pointWidth:1,custom:{maxmzmarker:"",intensitythreshold:0},data:{}}],exporting:{buttons:{btnToggleDataLabels:{text:"[toggle data labels]",onclick:function(){e.highcharts.event.renderLabel(),a(this.container).closest(".highcharts-container").toggleClass("show-all-labels")}}},enabled:!0}},highchartsImage:{exportUrl:"http://export.highcharts.com/",exportData:{options:null,type:"image/png",async:!0}}}}(jQuery,window,document);